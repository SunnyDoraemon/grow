# 打包和工具链

## 3.1 包
> Go程序由若干组文件组成，每组文件被称为一个包。每个包都可以单独导入和使用。<br>
> 所有的.go代码文件，除了空行和注释，都应该在第一行声明自己所属的包。每个包都在一个单独的目录里；不能能把多个包的文件放到同一个目录中，也不能把同一个包的文件拆分到多个不同目录中，同一个目录下的所有.go文件必须声明为同一个包名。

### 3.1.1 包名惯例
>一般而言，包的命名是使用包所在的目录名称，这样用户在导入包的时候能比较直观的知道包名。<br>
> 包名应该简洁、清晰且全小写。 <br>
> 并不需要所有包的名字都与别的包不用，因为导入包时是使用的全路径。

### 3.1.2 main包
> 在go语言中，命名为main的包具有特殊含义，go编译程序会试图把这种名字的包编译为二进制可执行文件。

## 3.2 导入
> import语句告诉编译器到磁盘哪里去找想要导入的包。<br>
> 导入多个包，习惯上是将import语句包裹到一个导入块中去。

```golang
import (
    "fmt"
    "strings"
)
```
编译器会使用Go环境变量设置的路径和引入的相对路径来查找磁盘上的包。<br>
- 标准库的包会在Golang的安装位置找到(`go env`-> `GOROOT变量值`)
- 用户创建的包会在`GOPATH`指定的目录去查找。

编译器会先去GOROOT查找，再按顺序去GOPATH变量里列出的目录查找；编译器一旦找到一个满足import语句的包，就停止进一步查找。

>  如果编译器查遍GOPATH也没找到要导入的包，那么在试图对程序执行`go run`和`go build`的时候就会出错；后面会介绍如何通过`go get`来修正这种错误。

### 3.2.1 远程导入
> 目前的大势所趋是，使用分布式版本控制(DVCS)来分享代码，比如github、launchpad、bitbucket。<br>
> go语言工具链本身就支持从这些网站及类似的网站获取源代码。go工具链会通过导入路径确定需要获取的代码在网络的什么地方。

**例如:**
```golang
import "github.com/spf13/viper"
```
使用导入路径编译程序时，`go build`命令会去`GOROOT`和`GOPATH`搜索这个包。但是事实上这个导入路径代表的是一个github的URL。如果导入路径包含URL,可以使用Go工具链从DVCS获取包并保存到`GOPATH`指定的路径中。这个获取过程使用`go get`命令完成，`go get`将获取任意指定的URL的包，或者一个已经导入包所依赖的其他包。由于`go get`的这种递归性，这个命令会扫描某个包的源码树，获取能找到的所有以来包。

### 3.2.2 命名导入
> 前面提到过，同一个程序内，包名可以相同（只要相对路径不同），如果包名相同了，怎么处理呢？

命名导入是指，在import语句中导入的包路径左侧定义一个名称，即给导入的包命新名。

**例如:**
```golang
import (
    "fmt"
    myfmt "user/fmt"
)
func main() {
    fmt.Println("Standard Library")
    myfmt.Println("user/fmt")
}
```
值得一提的是，当你导入了一个不被使用的包时，Go编译器会编译失败，并输出一个错误。<br>
Go团队认为这个特性可以防止导入了未曾使用的包，导致代码变得臃肿。虽然这个特性有一定争议，但是Go开发团队最终任决定加入这个特性。避免得到一个塞满未使用库的超大可执行文件。

> 基于上述特性，假如我们需要导入一个包，但并不显式调用，只是希望它的init()函数被执行，这种情况下如何导入这个包呢？

答案就是，使用`空白标识符`(下划线`_`)来重命名这个包，即可避免编译失败。


## 3.3 函数init
> 每个包都可以包含任意多个init函数，这些被编译器发现的init函数都会在main函数执行之前被执行。<br>
> init函数大多用于设置包、初始化变量或者其他要在程序运行前完成的初始化工作。

比如database下的驱动程序在启动时执行init函数将自身注册到sql包中:

```golang
// https://github.com/go-sql-driver/mysql/blob/v1.7.1/driver.go#L83
...
import (
    "database/sql"
)

...

func init() {
	sql.Register("mysql", &MySQLDriver{})
}
...
```

## 3.4 使用Go的工具

`go`这个工具命令提供了很多功能，如下所示:
```
Go is a tool for managing Go source code.

Usage:

	go <command> [arguments]

The commands are:

	bug         start a bug report
	build       compile packages and dependencies
	clean       remove object files and cached files
	doc         show documentation for package or symbol
	env         print Go environment information
	fix         update packages to use new APIs
	fmt         gofmt (reformat) package sources
	generate    generate Go files by processing source
	get         add dependencies to current module and install them
	install     compile and install packages and dependencies
	list        list packages or modules
	mod         module maintenance
	work        workspace maintenance
	run         compile and run Go program
	test        test packages
	tool        run specified go tool
	version     print Go version
	vet         report likely mistakes in packages

Use "go help <command>" for more information about a command.

Additional help topics:

	buildconstraint build constraints
	buildmode       build modes
	c               calling between Go and C
	cache           build and test caching
	environment     environment variables
	filetype        file types
	go.mod          the go.mod file
	gopath          GOPATH environment variable
	gopath-get      legacy GOPATH go get
	goproxy         module proxy protocol
	importpath      import path syntax
	modules         modules, module versions, and more
	module-get      module-aware go get
	module-auth     module authentication using go.sum
	packages        package lists and patterns
	private         configuration for downloading non-public code
	testflag        testing flags
	testfunc        testing functions
	vcs             controlling version control with GOVCS

Use "go help <topic>" for more information about that topic.
```
`go build hello.go` 编译

`go clean hello.go` 清除可执行文件和缓存

`go run hello.go` 构建 & 执行


## 3.5 进一步介绍Go开发工具

### 3.5.1 go vet
> vet命令会帮开发人员检测代码的常见错误。

- Printf函数调用时，类型匹配错误的参数。
- 定义常用的方法时，方法签名的错误。
- 错误的结构标签
- 没有指定字段名的字面量。

### 3.5.2 Go代码格式化

`go fmt`

### 3.5.3 Go语言的文档
> TODO

## 3.6 与其他Go开发者合作

以分享为目的创建代码库

1. 包应该在代码库的根目录中
2. 包可以非常小
3. 对代码执行go fmt
4. 给代码写文档

## 3.7 依赖管理
> TODO
